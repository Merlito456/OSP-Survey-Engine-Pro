<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />

  <meta name="theme-color" content="#0f172a" />
  <title>OSP Survey Tool Pro</title>

  <!-- PWA -->
  <link rel="manifest" href="./metadata.json" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Import Map -->
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@19.2.3",
      "react-dom/": "https://esm.sh/react-dom@19.2.3/"
    }
  }
  </script>

  <style>
    body { background:#0f172a; }
  </style>
</head>

<body class="h-screen text-white flex items-center justify-center">

  <!-- ===============================
       SERVER SELECT OVERLAY
       =============================== -->
  <div id="server-select" class="fixed inset-0 flex items-center justify-center bg-black/80 hidden">
    <div class="bg-slate-900 rounded-xl p-6 w-80 text-center space-y-4">
      <h2 class="text-xl font-semibold">Select Server</h2>

      <button
        class="w-full py-2 rounded bg-emerald-600 hover:bg-emerald-500"
        onclick="selectServer('github')"
      >
        GitHub Pages (Recommended)
      </button>

      <button
        class="w-full py-2 rounded bg-sky-600 hover:bg-sky-500"
        onclick="selectServer('netlify')"
      >
        Netlify (Backup)
      </button>

      <p class="text-xs text-slate-400">
        You can change this later by clearing site data.
      </p>
    </div>
  </div>

  <!-- App root -->
  <div id="root"></div>

  <!-- ===============================
       SERVER SELECTION LOGIC
       =============================== -->
  <script type="module">
    const SERVER_KEY = 'osp_server_choice';

    const isGitHubPages = location.hostname.endsWith('github.io');
    const isNetlify = location.hostname.endsWith('netlify.app');

    function loadEntry(choice) {
      const entry =
        choice === 'github'
          ? './index.js'
          : './index.tsx';

      import(entry).catch(err => {
        console.error('Failed to load entry:', err);
        alert('Failed to load selected server.');
      });
    }

    window.selectServer = (choice) => {
      localStorage.setItem(SERVER_KEY, choice);
      document.getElementById('server-select').classList.add('hidden');
      loadEntry(choice);
    };

    const saved = localStorage.getItem(SERVER_KEY);

    // Auto-select based on host if already on it
    if (isGitHubPages) {
      localStorage.setItem(SERVER_KEY, 'github');
      loadEntry('github');
    } else if (isNetlify) {
      localStorage.setItem(SERVER_KEY, 'netlify');
      loadEntry('netlify');
    }
    // No choice yet â†’ show selector
    else if (!saved) {
      document.getElementById('server-select').classList.remove('hidden');
    }
    // Load saved choice
    else {
      loadEntry(saved);
    }
  </script>
</body>
</html>
